<div class="sz-filters-section">
  <mat-form-field *ngIf="authService.CanManageAllFrEr() || authService.loggedUserInstance.leadOf.length">
    <mat-select placeholder="Solicitante" [(value)]="filterByUserId" (selectionChange)="filterErListData(filterByUserId)">
      <mat-option>Todos</mat-option>
      <mat-option *ngFor="let user of users" [value]="user.id">
        {{user.name + ' ' + user.lastName}}
      </mat-option>
    </mat-select>
  </mat-form-field>
  <mat-form-field>
    <mat-select placeholder="Proyecto" [(value)]="filterByProjectId" (selectionChange)="filterErListData(filterByProjectId)">
      <mat-option>Todos</mat-option>
      <mat-option *ngFor="let project of projects" [value]="project.id">
        {{project.name}}
      </mat-option>
    </mat-select>
  </mat-form-field>
  <mat-form-field>
    <mat-select placeholder="Estado" [(value)]="filterByState" (selectionChange)="filterErListData(filterByState)">
      <mat-option>Todos</mat-option>
      <mat-option *ngFor="let state of states" [value]="state">
        {{state}}
      </mat-option>
    </mat-select>
  </mat-form-field>
  <mat-form-field class="sz-search-box">
    <input matInput (keyup)="searchText($event.target.value)" placeholder="Buscar">
  </mat-form-field>
</div>

<table mat-table matSort class="mat-elevation-z2 sz-item-table" [dataSource]="erDataSource" matSortActive="code" matSortDirection="asc">
  <ng-container matColumnDef="code">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Solicitud </th>
    <td mat-cell *matCellDef="let report"> {{report.code}} </td>
  </ng-container>
  <ng-container matColumnDef="projectName">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Proyecto </th>
    <td mat-cell *matCellDef="let report"> {{projectService.getProjectName(report.projectId)}} </td>
  </ng-container>
  <ng-container matColumnDef="createUser">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Usuario </th>
    <td mat-cell *matCellDef="let report"> {{userService.getCompleteUserName(report.createUserId)}} </td>
  </ng-container>
  <ng-container matColumnDef="totalSpent">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Total Gastado </th>
    <td mat-cell *matCellDef="let report"> {{report.totalSpent}} </td>
  </ng-container>
  <ng-container matColumnDef="totalReceived">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Total Recibido </th>
    <td mat-cell *matCellDef="let report"> {{report.totalReceived}} </td>
  </ng-container>
  <ng-container matColumnDef="balance">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Saldo </th>
    <td mat-cell *matCellDef="let report"> {{report.balance}} </td>
  </ng-container>
  <ng-container matColumnDef="state">
    <th mat-header-cell *matHeaderCellDef mat-sort-header> Estado </th>
    <td mat-cell *matCellDef="let report"> {{report.state}} </td>
  </ng-container>
  <ng-container matColumnDef="editBtn">
    <th mat-header-cell *matHeaderCellDef> </th>
    <td mat-cell *matCellDef="let report">
      <button mat-stroked-button color="primary" type="button" (click)="onEditExpenseReport(report.id)">{{report.isSent ? 'Ver' : 'Editar'}}</button>
      <button mat-raised-button color="primary" type="button" (click)="onSendExpenseReport(report)" *ngIf="!report.isSent">Enviar</button>
      <button mat-raised-button color="primary" type="button" (click)="onApproveExpenseReport(report)" *ngIf="report.isSent && authService.CanApproveEr(report)">Aprobar</button>
      <button mat-raised-button color="warn" type="button" (click)="onRejectExpenseReport(report)" *ngIf="report.isSent && authService.CanApproveEr(report)">Rechazar</button>
      <button mat-button color="warn" type="button" (click)="onDeleteExpenseReport(report.id)" *ngIf="!report.isSent">Eliminar</button>
    </td>
  </ng-container>
  <tr mat-header-row *matHeaderRowDef="erListColumns; sticky: true"></tr>
  <tr mat-row *matRowDef="let row; columns: erListColumns;"></tr>
</table>
<br>
<button mat-raised-button color="primary" (click)="onSelectFundingRequest()"> Crear </button>